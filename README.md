# MAT-to-PASCAL_VOC
An easy way to convert images annotated in MATLAB to a Pascal VOC 2007 dataset format. This way you can have your own custom dataset containing your own classes and images.

## Ways to convert .mat annotation file to csv:
- Export the .mat annotation file as .mat labels file from the option provided in MATLAB.
- Type the following code in MATLAB command window:
  1. load('path/to/example.mat')
  2. gTruth
  3. labels=objectDetectorTrainingData(gTruth)
  4. writetable(labels, ‘path/to/save/example.csv’, ‘Delimiter’, ‘ ’)

## Prerequisites:
1. Create a folder named 'dataset' at root directory.
2. Download PascalVoc devkit from the link provided below. Extract the zip and place the folder at root directory.
   https://drive.google.com/open?id=1uJ_XjN9ayooCJF7iifrIAfSnzAmXrJbP
3. Place the image folders and their respective csv files(obtained from exporting the labels and then writing gTruth of that file, in MATLAB) in dataset folder, located in the root directory. Remember that the names of the image folders and their respective csv files must be the same and start with ‘img’ prefix, followed by a number or a string.

## How to use:
### 1. Run the XMLconvert.ipynb.

1. Input – Image folders and csv files in dataset folder.
2. Output – 
	1. XML files in Annotations folder.  
	2. Images in JPEGImages folder.
	3. ‘exp.csv’, located in root directory.
This code,
	
  a) Takes only those folders and csv files with ‘img’ prefixed in their name.
	
  b) Exports the correct csv files. In some csv files of MATLAB, there were non +ve annotation values(due to some different release version). These non +ve annotations were having value as ‘-1’ and ‘0’ only, so this code aims at converting these non +ve values to ‘1’ because all the annotations should be positive(as non +ve annotations dont make sense) and	first positive number after these values(-1 and 0) is 1. This correct csv file is exported to ‘corr_csv’ located in root directory.
	
  c) Takes care of those data folders wherein one or more classes are not present in the entire folder. When exporting label files of such folders, the classes which are not present create a single empty column which interferes with the logic of the code.
	
  d) It takes only those files which are of ‘jpeg’ format, images in other formats like ‘png’ create problem when working with info related to images like width, height and especially depth(no of channels). For this purpose, ‘imghdr’ library is used to determine the format of images.
		
  e) Creates xml files of the images provided in the dataset folder using the data provided for each image in csv files. These xml files are created according to the pascal voc dataset format.
	
  f) Populates the Annotations and JPEGImages folders located under ./VOCdevkit2007/VOC2007. ‘Annotations’ folder is populated with all the xml files generated and ‘JPEGImages’ folder consists of all the images provided in the dataset folder. The images and xml files are renumbered on the fly so that all the images from all the folders(in dataset folder) can be treated as a single dataset. 
	
  g) Exports a csv file named ‘exp.csv’, which will be used for creating training, validating and testing text files for pascal voc dataset. In this file first column of each class(recall the format in which MATLAB exports csv file) is present. So that we can easily check which objects are present in a given image. If the value under the column of a given class is -1 then that particular class is not present in image, otherwise(if value is a +ve integer) the class is present.

### 2. Run create.ipynb.

1. Input – ‘exp.csv’, generated by XMLconvert.ipynb
2. Output – 
	1. trainval.txt, train.txt, val.txt and test.txt in Layout folder.
	2. Object class specific files of the above listed files, in Main folder. Like person_train.txt, person_val.txt, person_trainval.txt and person_test.txt
 
This code,
	
  a) Makes use of ‘exp.csv’ exported from XMLconvert.ipynb. So, make sure exp.csv is present at the root directory.
	
  b) Populates the Layout folder(located under ./VOCdevkit2007/VOC2007/ImageSets), with several files, namely train.txt, 	val.txt, trainval.txt and test.txt. These files contain the names(evidently numbers) of the images present in the JPEGImages(located under /VOCdevkit2007/VOC2007) folder for the different purposes as suggested by the name of each file.
	
  c) Populates the ‘Main’ folder(located under ./VOCdevkit2007/VOC2007/ImageSets), with four files corresponding to each class i.e. Total Files = 4*(No. Of classes). Each class 	has four files that are train, val, trainval, test. For eg, if there is a class person then the four files created corresponding to this class will be, person_train.txt, person_val.txt, person_trainval.txt and person_test.txt. These separate files will be used for train, val, trainval and test in case of different classes. 
	These files contain an integer(either -1 or 1) that indicates whether the image(specified by the number in these files) contains the object from a particular class or not where, ‘-1’ implies class not present and ‘1’ implies class is present in a given image.
	
  d) Copies files from Layout folder(i.e. train.txt, val.txt, trainval.txt and test.txt) into Main folder(needed by the code in faster rcnn).

### OR

  Run create_random.ipynb to select random images for test and train. Works same as create.ipynb just selects images randomly.
